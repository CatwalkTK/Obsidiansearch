# 社内ナレッジ可視化AI

AIを活用したWebインターフェースで、社内に蓄積されたナレッジを検索・分析・活用することができます。マークダウンファイルをアップロードし、AI駆動のスマート機能により、蓄積された情報を効率的に探索・理解できます。

## 主要機能概要

### 🤖 Phase 1 スマート機能（最新実装）
- **AI質問候補生成**: ナレッジベースを分析し、有意義な質問を自動提案
- **包括的分析ダッシュボード**: 検索パターン、人気トピック、使用統計を可視化
- **インテリジェント要約システム**: 複数ドキュメントから階層的要約を自動生成
- **クリック可能なファイル参照**: 絶対パスでファイル位置を正確に表示
- **外部データ承認フロー**: 社内ナレッジ外の情報使用を適切に制御

### 🔍 AI駆動検索エンジン
- **動的同義語システム**: 手動辞書不要、AIがリアルタイムで文脈適応型同義語を生成
- **統合的スコアリング検索**: パス一致度、セマンティック類似度、コンテンツ一致度を統合評価
- **高精度日付検索**: 「9月5日の授業」等の日付関連クエリを最適化
- **三層アーキテクチャ**: AI生成・セマンティック強化・適応学習の組み合わせ

### 🛡️ セキュリティ・プライバシー
- **完全ローカル処理**: ファイルはブラウザ内でのみ処理、サーバーアップロード無し
- **環境変数対応**: APIキーの安全な管理
- **承認制外部データ**: ユーザーが完全制御する安全設計

## 詳細機能

### 💡 AI質問候補生成（Phase 1 新機能）
- **文脈感知提案**: ナレッジベースの内容を分析し、有意義で回答可能な質問を自動生成
- **カテゴリー別整理**: 業務、学習、技術など分野別に質問を分類表示
- **信頼度評価**: 各質問の回答品質を事前評価（高・中・低）
- **関連ファイル表示**: 各質問に対応する参照元ファイルを明示
- **パーソナライゼーション**: ユーザーの検索履歴に基づく個別最適化

### 📊 包括的分析ダッシュボード（Phase 1 新機能）
- **リアルタイム統計**: 検索回数、人気キーワード、アクティブ時間帯を可視化
- **トピック分析**: 頻繁に検索される内容領域をマップ化
- **利用パターン**: 質問傾向と回答成功率の分析
- **検索効率**: クエリ最適化の提案と改善点の特定
- **60分間自動更新**: 最新の利用状況を継続的に追跡

### 🧠 インテリジェント要約システム（Phase 1 新機能）
- **階層的要約生成**: 複数ドキュメントから包括的なトピック要約を作成
- **重要ポイント抽出**: キーとなる情報を自動識別・整理
- **関連トピック発見**: 主題に関連する追加情報を提案
- **信頼度スコア**: 要約の正確性を数値化（0-1スケール）
- **参照元追跡**: 各情報の出典ファイルを明確に表示

### 🔍 高度検索エンジン
- **AI駆動同義語システム**: 手動辞書不要、GPT/Geminiによるリアルタイム同義語生成
- **30分間インテリジェントキャッシュ**: 高速化とコスト最適化を両立
- **統合的スコアリング**: パス一致度、セマンティック類似度、コンテンツ一致度を統合評価
- **日付検索最適化**: 「9月5日の授業」等の時系列クエリに特化した精度向上
- **動的しきい値調整**: クエリタイプに応じた最適な判定基準を自動適用

### 🛡️ セキュリティ・制御機能
- **外部データ承認フロー**: 社内ナレッジ外の情報使用を事前確認
- **独立質問処理**: 各質問を完全独立処理、会話履歴の誤影響を防止
- **フォローアップ検出**: 「詳しく」「なぜ」等の明確なフォローアップのみ履歴使用
- **プライバシー保護**: 全処理がブラウザ内完結、サーバーアップロード無し
- **環境変数対応**: APIキーの安全な管理と自動プロバイダー選択

## システム動作原理

### 📂 1. ナレッジ取り込み・ベクトル化
- **ファイル読み込み**: ブラウザ内でマークダウンファイルを直接処理
- **スマートチャンク化**: パラグラフ・センテンス対応の最適分割（1200文字、300文字重複）
- **ベクトル埋め込み**: 各チャンクをAIモデルで数値ベクトルに変換
- **インデックス構築**: 高速検索用のローカルデータベースを作成

### 🤖 2. AI質問候補生成（Phase 1）
- **ナレッジ分析**: ドキュメント内容から有意義な質問パターンを抽出
- **カテゴリー分類**: 業務・学習・技術等の分野別に質問を整理
- **信頼度計算**: 各質問の回答可能性を事前評価
- **60分間キャッシュ**: 質問候補の効率的な再利用

### 🔍 3. 高度検索実行
- **AI同義語拡張**: 「退職手続き」→「辞める、離職、退社手順」等を自動生成
- **三層スコアリング**:
  - パススコア（ファイル名一致度）
  - セマンティックスコア（意味的類似度）
  - コンテントスコア（本文キーワード一致度）
- **統合ランキング**: 全チャンクを公平に評価・順位付け
- **動的しきい値**: 日付クエリと一般クエリで最適化された判定基準

### 🧠 4. インテリジェント回答生成
- **コンテキスト最適化**: 最高スコアのチャンクを厳選してAIに提供
- **信頼性保証**: 提供された社内ナレッジのみに基づく回答を指示
- **要約システム**: 複数ドキュメントから階層的要約を自動生成
- **参照追跡**: 回答の根拠となるファイルを絶対パスで明示

### 🛡️ 5. 承認制外部データフロー
- **不足検出**: 社内ナレッジで回答不可能な場合を自動判定
- **承認プロンプト**: 「外部の一般知識を使用しますか？」と確認
- **制御された回答**: 承認時のみGPT/Geminiの内蔵知識を活用
- **透明性確保**: 外部データ使用時は明確にマーキング

### 📊 6. 分析・学習システム（Phase 1）
- **利用統計収集**: 検索パターン、人気トピック、成功率を追跡
- **ダッシュボード表示**: リアルタイム分析結果の可視化
- **適応学習**: ユーザー行動から同義語関係を自動学習
- **継続改善**: 検索精度と使用体験の段階的向上

## クイックスタート

### 前提条件
- モダンなWebブラウザ（Chrome, Firefox, Safari, Edge）
- Google Gemini APIキーまたはOpenAI APIキー
  - **Gemini（推奨）**: [Google AI Studio](https://aistudio.google.com/app/apikey)
  - **OpenAI**: [OpenAI Platform](https://platform.openai.com/api-keys)

### 🚀 開発環境セットアップ

```bash
# 1. 依存関係インストール
npm install

# 2. 環境変数設定（推奨方法）
# .envファイルを作成
echo "GEMINI_API_KEY=your_api_key_here" > .env

# 3. 開発サーバー起動
npm run dev

# 4. ブラウザでアクセス
# ローカル: http://localhost:5173/
# Codespaces: 提供されるURL使用
```

### 🏭 本番環境デプロイ

```bash
# ビルド実行
npm run build

# dist/フォルダを任意のWebサーバーに配信
# 例: Nginx, Apache, CDN等
```

### ⚙️ 設定オプション

**環境変数使用（推奨）**:
```bash
# .env ファイル
GEMINI_API_KEY=your_gemini_key
# または
OPENAI_API_KEY=your_openai_key
```

**UI設定**:
環境変数未設定時はアプリ起動後にUI上でAPIキー入力可能

## 使用方法

### 📝 基本的な使い方

**1. 初期設定**
- アプリを開く → API設定確認（環境変数設定済みの場合自動）
- 未設定時：AIプロバイダー選択 → APIキー入力

**2. ナレッジ読み込み**
- 「ナレッジフォルダを選択」をクリック
- マークダウンファイル格納フォルダを選択
- 処理完了まで待機（ファイル数に応じて数秒〜数分）

**3. AI質問候補の活用（Phase 1新機能）**
- 読み込み完了後、自動生成された質問候補が表示
- カテゴリー別（業務・学習・技術）に分類
- 各質問の信頼度（高・中・低）を確認
- クリックで即座に質問実行

**4. 自由質問・検索**
- 下部入力ボックスに質問を入力
- `Enter`キーまたは「送信」ボタンで実行
- AI同義語展開により高精度検索を実現

**5. 分析ダッシュボードの確認（Phase 1新機能）**
- 「分析」タブで利用統計を可視化
- 検索パターン、人気トピック、成功率を追跡
- 60分間隔で自動更新

### 🛡️ 外部データ承認フロー

**承認条件**
- 一般クエリ：セマンティック類似度 < 0.7、統合スコア < 0.8
- 日付クエリ：セマンティック類似度 < 0.3、統合スコア < 0.4

**承認プロセス**
1. 社内ナレッジで回答不可能と判定
2. 「外部の一般知識を使用しますか？」プロンプト表示
3. **「はい」**：GPT/Geminiの内蔵知識で回答生成（明示的マーキング付き）
4. **「いいえ」**：「見つかりませんでした」メッセージ表示

**独立処理設計**
- 各質問が完全独立処理
- 承認拒否が次回質問に影響しない
- フォローアップ（「詳しく」「なぜ」等）時のみ履歴使用

### 🧪 機能テスト方法

**AI質問候補テスト**
- ナレッジ読み込み後、自動生成される質問の品質確認
- 信頼度スコア（高・中・低）の妥当性チェック
- カテゴリー分類の適切性確認

**同義語システムテスト**
- 「退職手続き」→「辞める、離職、退社手順」展開確認
- 「会議準備」→「打ち合わせ、ミーティング、準備手順」展開確認
- ブラウザ開発者ツールで`getSynonymCacheStats()`実行

**承認機能テスト**
- 「今日の天気」「ChatGPTについて」等の外部情報質問
- 承認→拒否→再質問の継続性確認
- 日付検索（「9月5日の授業」等）の精度確認

**分析ダッシュボードテスト**
- 複数回検索後の統計データ確認
- 人気キーワード・トピックの正確性
- リアルタイム更新の動作確認

## 技術スタック

### 🖥️ フロントエンド・UI
- **React 19+**: 最新のReactフックとサスペンス機能
- **TypeScript**: 型安全な開発環境
- **Tailwind CSS**: ユーティリティファーストなスタイリング
- **Vite**: 高速HMR対応のモダンビルドツール

### 🤖 AI・機械学習
- **Google Gemini API** (`@google/genai`): 同義語生成・質問候補・要約
- **OpenAI API** (`openai`): GPT-4による高精度言語処理
- **ベクトル埋め込み**: コサイン類似度による意味検索
- **階層的要約**: 複数ドキュメントからの知識抽出

### 🔧 Phase 1 スマート機能アーキテクチャ
```
services/
├── questionSuggestionService.ts  # AI質問候補生成
├── analyticsService.ts           # 包括的分析システム
├── summaryService.ts             # インテリジェント要約
├── dynamicSynonymService.ts      # AI同義語生成（30分キャッシュ）
├── semanticEnhancementService.ts # クエリパターン拡張
└── adaptiveSynonymService.ts     # 学習型同義語構築
```

### 🏗️ システム設計
- **モジュールシステム**: `esm.sh`によるブラウザ内ESモジュール
- **ローカルファースト**: 完全ブラウザ内処理、サーバーレス
- **キャッシング戦略**: 多層キャッシュによるパフォーマンス最適化
- **開発環境**: GitHub Codespaces、WSL2完全対応

### 🎯 パフォーマンス最適化
- **同義語キャッシュ**: 30分間有効、API呼び出し数削減
- **質問候補キャッシュ**: 60分間有効、ナレッジ変更時自動更新
- **統計データキャッシュ**: リアルタイム更新とブラウザ永続化
- **フォールバック設計**: AI機能失敗時も基本機能は正常動作

### 🧪 開発者ツール
```javascript
// ブラウザコンソールで利用可能
window.getSynonymCacheStats()    // 同義語キャッシュ統計
window.clearSynonymCache()       // キャッシュクリア
window.getAnalyticsData()        // 分析データ取得
window.clearAnalyticsData()      // 分析データリセット
```

## トラブルシューティング

### 🚨 一般的な問題

**API認証エラー (HTTP 401)**
```bash
# 1. 環境変数確認
cat .env

# 2. 開発サーバー再起動
npm run dev

# 3. ブラウザキャッシュクリア
# F12 → Network → Disable cache
```

**Phase 1機能が動作しない**
```javascript
// ブラウザコンソールでデバッグ
console.log(window.getAnalyticsData())
console.log(window.getSynonymCacheStats())

// キャッシュリセット
window.clearSynonymCache()
window.clearAnalyticsData()
```

**ファイル読み込みエラー**
- マークダウンファイル（.md）のみ対応
- ファイルサイズ制限：1ファイル50MB以下
- フォルダ権限確認（読み取り権限必要）

### 🖥️ Windows WSL環境

**基本セットアップ**
```bash
# WSL内でクローン・実行
cd ~
git clone <repository-url>
cd Obsidiansearch
npm install
echo "GEMINI_API_KEY=your_key" > .env
npm run dev -- --host 0.0.0.0
```

**ポート接続問題**
```powershell
# Windows PowerShellで実行
netsh interface portproxy add v4tov4 listenport=5173 listenaddress=0.0.0.0 connectport=5173 connectaddress=(wsl hostname -I)
```

**ファイルアクセス**
- Windowsファイル：`/mnt/c/Users/...`
- WSLファイル：`/home/...` （推奨）

### ☁️ GitHub Codespaces

**URL設定**
- `localhost:5173` → Codespaces提供URL使用
- ポート転送設定確認
- 公開設定変更（必要に応じて）

**パフォーマンス最適化**
```bash
# Codespacesマシンスペック確認
df -h
free -h

# 軽量化設定
export NODE_OPTIONS="--max-old-space-size=2048"
```

### 🔧 Phase 1機能デバッグ

**AI質問候補が生成されない**
```javascript
// デバッグコマンド
window.clearAnalyticsData()
location.reload()

// APIキー確認
console.log(!!process.env.GEMINI_API_KEY || !!process.env.OPENAI_API_KEY)
```

**分析ダッシュボードが空白**
```javascript
// 手動データ生成（テスト用）
window.recordSearchEvent('テストクエリ', ['test.md'], 0.8, 'test')
```

**同義語システム問題**
```javascript
// 同義語生成テスト
window.clearSynonymCache()
// 検索実行 → キャッシュ統計確認
window.getSynonymCacheStats()
```

### 🐛 よくある解決策

**1. 完全リセット**
```bash
# プロジェクトリセット
rm -rf node_modules package-lock.json
npm install
npm run dev
```

**2. ブラウザデータクリア**
```javascript
// 全データ初期化
localStorage.clear()
sessionStorage.clear()
window.clearSynonymCache()
window.clearAnalyticsData()
```

**3. 環境変数確認**
```bash
# 設定確認
echo $GEMINI_API_KEY
echo $OPENAI_API_KEY

# .env再読み込み
source .env
npm run dev
```