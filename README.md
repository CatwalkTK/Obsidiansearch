# 社内ナレッジ可視化AI

AIを活用したWebインターフェースで、社内に蓄積されたナレッジを検索したり、チャットしたりすることができます。マークダウンファイルをアップロードし、蓄積された情報に基づいて質問をすることで、的確な答えを得ることができます。

## カスタマイズ内容

本アプリケーションは元のObsidian Vault AI検索から以下のようにカスタマイズされています：

### ブランディング変更
- **アプリケーション名**: 「Obsidian Vault AI検索」→「社内ナレッジ可視化AI」
- **コンセプト**: Obsidian専用から汎用的な社内ナレッジ管理ツールへ
- **UI表記**: 全ての「Vault」「Obsidian」表記を「社内ナレッジ」に統一

### 環境変数対応
- **.envファイルサポート**: APIキーを環境変数で管理可能
- **自動API設定**: 環境変数にキーがある場合、UI上でのキー入力をスキップ
- **プロバイダー自動検出**: 利用可能なAPIキーに基づいてデフォルトプロバイダーを自動選択

### セキュリティ強化
- **WebSocket CSP対応**: Content Security PolicyでWebSocket接続を許可
- **開発環境対応**: GitHub CodespacesでのWebSocket接続問題を解決

## 機能

-   **LLM選択可能**: Google GeminiまたはOpenAIのモデルを選択して対話できます。
-   **統合的スコアリング検索**: パスの一致度（ファイル名）、意味の近さ（セマンティック検索）、内容のキーワード一致度という複数の指標を統合的に評価する、高度な検索技術を採用。これにより、AIの視野を狭めることなく、複数の関連ファイルを横断して最も的確な情報を見つけ出し、検索精度を飛躍的に向上させます。
-   **プライバシー第一**: あなたのノートとAPIキーはブラウザ内でローカルに処理されます。サーバーにアップロードされることはなく、質問に必要な文脈のみがAIに送信されます。
-   **シンプルなインターフェース**: 直感的でクリーンなチャットインターフェースにより、スムーズな体験が可能です。
-   **Markdownサポート**: Vault内の`.md`ファイルをネイティブに理解し、処理します。

## 仕組み

1.  **AIプロバイダーの設定**: アプリケーションを開き、使用したいAIプロバイダー（GeminiまたはOpenAI）を選択し、対応するAPIキーを入力します。
2.  **Vaultの選択**: ファイルピッカーを使用して、お使いのObsidian Vaultのディレクトリを選択します。
3.  **ローカルでのベクトル化**: アプリケーションは、ブラウザ内で直接すべてのマークダウン(`.md`)ファイルを読み込み、意味のある小さな「チャンク」に分割します。その後、選択したAIモデルを使用して各チャンクをベクトル化（意味を数値配列に変換）し、検索可能なインデックスを作成します。
4.  **統合的スコアリングの実行**: あなたが質問をすると、システムはVault内のすべての情報の断片（チャンク）一つひとつに対して、以下の要素を基に総合的な関連度スコアを計算します。
    a.  **パススコア**: 質問のキーワードがチャンクの**ファイルパス**にどれだけ含まれているか。
    b.  **セマンティックスコア**: 質問の「意味」とチャンクの内容が文脈的にどれだけ近いか。
    c.  **コンテントスコア**: 質問のキーワードがチャンクの**本文**にどれだけ含まれているか。
5.  **インテリジェントなコンテキスト生成**:
    -   算出された総合スコアに基づき、すべてのチャンクが単一のリスト上で公平にランク付けされます。
    -   スコアが最も高い、複数のファイルにまたがる可能性のある、最も関連性の高いチャンクだけを厳選し、AIへのコンテキストとして使用します。
6.  **信頼性のある回答**: AIは、提供されたコンテキストの情報に**のみ**基づいて回答するよう特別に指示されています。これにより、回答があなた自身の知識ベースから得られることが保証されます。答えが見つからない場合は、その旨を伝えます。
7.  **回答の表示**: AIの応答がチャットインターフェースに表示されます。

## はじめに

### 前提条件

-   モダンなウェブブラウザ（例：Chrome, Firefox, Safari, Edge）。
-   Google Gemini APIキーまたはOpenAI APIキー。
    -   Gemini: [Google AI Studio](https://aistudio.google.com/app/apikey)から取得できます。
    -   OpenAI: [OpenAI Platform](https://platform.openai.com/api-keys)から取得できます。

### セットアップ

#### 開発環境での実行

1. **依存関係のインストール**:
   ```bash
   npm install
   ```

2. **環境変数の設定**（推奨）:
   プロジェクトルートに`.env`ファイルを作成し、以下のようにAPIキーを設定：
   ```bash
   # Gemini APIキー（推奨）
   GEMINI_API_KEY=your_gemini_api_key_here
   
   # または OpenAI APIキー
   # OPENAI_API_KEY=your_openai_api_key_here
   ```

3. **開発サーバーの起動**:
   ```bash
   npm run dev
   ```

4. **アプリへのアクセス**: 
   - ローカル環境: `http://localhost:5173/`
   - GitHub Codespaces: 提供されるCodespaces URLを使用

#### 本番環境での実行

1. **ビルド**:
   ```bash
   npm run build
   ```

2. **静的ファイルの配信**:
   `dist/`フォルダの内容を任意のWebサーバーで配信

#### 環境変数を使用しない場合

`.env`ファイルを設定しない場合、アプリケーション起動時にUI上でAPIキーを入力する従来の方式で利用できます。

## 使い方

### 環境変数でAPIキーを設定済みの場合
1. アプリケーションを開くと、API設定が完了している旨が表示されます
2. **「ナレッジフォルダを選択」**エリアをクリックします
3. ファイル選択ダイアログで、マークダウンファイルが格納されたフォルダを選択します
4. ファイルが処理されるのを待ちます
5. 下部の入力ボックスに質問を入力し、`Enter`キーを押すか**「送信」**ボタンをクリックします

### 環境変数を使用しない場合
1. アプリケーションを開き、まず**AIプロバイダーを選択**し、あなたの**APIキーを入力**します
2. **「ナレッジフォルダを選択」**エリアをクリックします
3. ファイル選択ダイアログで、マークダウンファイルが格納されたフォルダを選択します
4. ファイルが処理されるのを待ちます。チャットウィンドウの上部に、読み込まれたファイル数を示す確認メッセージが表示されます
5. 下部の入力ボックスに質問を入力し、`Enter`キーを押すか**「送信」**ボタンをクリックします

## 技術スタック

-   **フロントエンド**: React, TypeScript, Tailwind CSS
-   **ビルドツール**: Vite
-   **AI**: Google Gemini API (`@google/genai`), OpenAI API (`openai`)
-   **モジュールシステム**: `esm.sh`を介したブラウザ内ESモジュール
-   **開発環境**: GitHub Codespaces対応

## トラブルシューティング

### GitHub Codespacesでの使用
- `localhost:5173`ではなく、Codespacesが提供するURL（例：`https://xxx-5173.app.github.dev/`）を使用してください
- ポート転送の設定を確認し、必要に応じて公開設定を変更してください

### HTTP 401エラーが発生する場合
1. 環境変数に正しいAPIキーが設定されているか確認
2. 開発サーバーを再起動（`npm run dev`）
3. ブラウザのキャッシュをクリア

### WebSocket接続エラーが発生する場合
- Content Security Policy (CSP) の設定により、適切なWebSocket接続が許可されています
- 開発サーバーの再起動で解決する場合があります